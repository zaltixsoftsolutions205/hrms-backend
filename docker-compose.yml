services:

  hrms-backend:
    image: public.ecr.aws/n2e2a2z5/hrms-backend:latest
    container_name: hrms-backend
    restart: unless-stopped

    ports:
      - "${PORT:-5000}:5000"

    environment:
      NODE_ENV: production
      PORT: 5000
      MONGO_URI: ${MONGO_URI}
      JWT_SECRET: ${JWT_SECRET}
      JWT_EXPIRES_IN: ${JWT_EXPIRES_IN:-7d}

    volumes:
      - hrms_uploads:/app/uploads

    networks:
      - hrms_network

    healthcheck:
      test: ["CMD", "curl", "-fs", "http://localhost:5000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s


  mongo:
    image: mongo:7-jammy
    container_name: hrms-mongo
    restart: unless-stopped

    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_ROOT_PASS}
      MONGO_INITDB_DATABASE: hrms_db

    volumes:
      - mongo_data:/data/db

    networks:
      - hrms_network

    healthcheck:
      test: ["CMD", "mongosh", "--quiet", "--eval", "db.adminCommand('ping').ok"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 30s


volumes:
  mongo_data:
  hrms_uploads:

networks:
  hrms_network:
    driver: bridge
